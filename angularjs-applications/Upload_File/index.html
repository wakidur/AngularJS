<!DOCTYPE html>
<html>
    <head>
        <title>file upload</title>
        <script src = "angular/angular.min.js"></script>
        <script type="text/javascript">
            var myApp = angular.module('myApp', []);

            myApp.directive('fileModel', ['$parse', function ($parse) {
                    return {
                        restrict: 'A',
                        link: function (scope, element, attrs) {
                            var model = $parse(attrs.fileModel);
                            var modelSetter = model.assign;

                            element.bind('change', function () {
                                scope.$apply(function () {
                                    modelSetter(scope, element[0].files[0]);
                                });
                            });
                        }
                    };
                }]);

            // We can write our own fileUpload service to reuse it in the controller
            myApp.service('fileUpload', ['$http', function ($http) {
                    this.uploadFileToUrl = function (file, uploadUrl, name) {
                        var fd = new FormData();
                        fd.append('file', file);
                        fd.append('name', name);
                        $http.post(uploadUrl, fd, {
                            transformRequest: angular.identity,
                            headers: {'Content-Type': undefined, 'Process-Data': false}
                        })
                                .success(function () {
                                    console.log("Success");
                                })
                                .error(function () {
                                    console.log("Success");
                                });
                    }
                }]);

            myApp.controller('myCtrl', ['$scope', 'fileUpload', function ($scope, fileUpload) {
                    $scope.uploadFile = function () {
                        console.log("Hello");
                        var file = $scope.myFile;
                        console.log('file is ');
                        console.dir(file);
                        var uploadUrl = "save_form.php";
                        var text = $scope.name;
                        fileUpload.uploadFileToUrl(file, uploadUrl, text);
                    };
                }]);
        </script>
    </head>

    <body ng-app="myApp" ng-controller="myCtrl">
        <form method="POST">
            <div class="file-upload">
                <input type="text" data-ng-model="name">
                <input type="file" data-file-model="myFile"/>
                <button data-ng-click="uploadFile()">upload me</button>
            </div>
        </form>

    </body>
</html>
